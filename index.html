<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ì¡´ ë””ìì¸ ì™„ë²½ ìœ ì§€ */
        :root { --primary-color: #e31837; --bg-color: #f8f9fa; --card-bg: #ffffff; --text-color: #333; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; background: var(--card-bg); padding: 30px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .logo-container { text-align: center; margin-bottom: 20px; }
        .main-logo { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary-color); }
        .header h2 { color: var(--primary-color); text-align: center; margin: 0; font-size: 22px; }
        .notice-banner { background-color: #fff1f0; color: var(--primary-color); padding: 12px; border-radius: 12px; text-align: center; font-weight: bold; font-size: 13px; margin-bottom: 20px; border: 1px solid #ffa39e; }
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 13px; color: #666; }
        input, select { width: 100%; padding: 14px; margin-top: 8px; border: 1px solid #e1e1e1; border-radius: 12px; box-sizing: border-box; font-size: 16px; }
        .submit-btn { width: 100%; background: var(--primary-color); color: white; border: none; padding: 18px; border-radius: 15px; font-size: 18px; font-weight: bold; margin-top: 25px; cursor: pointer; }
        #successView, #receiptView { display: none; text-align: center; }
        .receipt-card { background: #fff; border: 1px solid #eee; padding: 25px; border-radius: 15px; text-align: left; position: relative; margin-bottom: 20px; border-top: 8px solid var(--primary-color); }
        
        /* ğŸ†• ì„¸ë¸Œë€ìŠ¤ ë¡œê³  ë²„íŠ¼ìš© ë””ìì¸ ì¶”ê°€ */
        .admin-logo { 
            display: block; 
            margin: 30px auto 0; /* ìœ„ìª½ ì—¬ë°± 30px, ê°€ìš´ë° ì •ë ¬ */
            width: 140px; /* ë¡œê³  í¬ê¸° ì¡°ì ˆ (í•„ìš”ì‹œ ìˆ«ì ë³€ê²½ ê°€ëŠ¥) */
            cursor: pointer; 
            opacity: 0.8; /* ì‚´ì§ íˆ¬ëª…í•˜ê²Œ í•´ì„œ ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ëŠë‚Œ */
            transition: opacity 0.3s;
        }
        .admin-logo:hover { opacity: 1; } /* ëˆ„ë¥¼ ë•Œ ì„ ëª…í•´ì§ */
    </style>
</head>
<body>

<div class="container" id="inputView">
    <div class="logo-container"><img src="https://naverbooking-phinf.pstatic.net/20220823_58/1661214384331sJDvb_PNG/1%C0%CE%BC%BC%C6%AE_4_%B0%A5%B8%AF%BA%A3%C0%CC%C4%C1%C4%A1%C1%EE_1200X1200.png?type=f459_345_60_sharpen" class="main-logo"></div>
    <div class="header"><h2>EGG DROP</h2></div>
    <div class="notice-banner">ğŸ“¢ ìŠ¤ë§ˆíŠ¸ ì°¨ê° ê´€ë¦¬ ì‹œìŠ¤í…œ</div>

    <label>ë‚ ì§œ</label><input type="date" id="date">
    <label>ì´ë¦„ (ë³¸ì¸ í¬í•¨ ì „ì› ê¸°ì¬)</label>
    <input type="text" id="name" placeholder="ì˜ˆ) í™ê¸¸ë™, ê¹€ê¸¸ë™ ë“±">

    <label>ì¸ì›ìˆ˜ ì„ íƒ</label>
    <select id="peopleCount">
        <script>
            for(let i=1; i<=20; i++) {
                document.write(`<option value="${i}">${i}ëª…</option>`);
            }
        </script>
    </select>

    <label>ì´ ê²°ì œê¸ˆì•¡ ì…ë ¥(ì¶”ê°€ ê²°ì œ í¬í•¨)</label>
    <input type="text" id="receiptAmount" placeholder="ì˜ˆ) 10,650" oninput="cleanNumberInput(this)">
    
    <div style="margin-top: 10px; font-size: 11px; color: #e31837; font-weight: bold; line-height: 1.4;">
        * 1ì¸ë‹¹ 1ë§Œì› ì´ˆê³¼ ì‹œ ì¶”ê°€ê²°ì œ í•„ìš”, ë¯¸ë‹¬ ì‹œ ì…ë ¥í•œ ê¸ˆì•¡ ì „ì•¡ì´ ì°¨ê°ë©ë‹ˆë‹¤.
    </div>

    <button class="submit-btn" id="submitBtn" onclick="confirmAndSubmit()">ì£¼ë¬¸ ì €ì¥í•˜ê¸°</button>
    
    <img src="https://tistory1.daumcdn.net/tistory/4488967/skin/images/severancemm.jpg" alt="ì„¸ë¸Œë€ìŠ¤ ë¡œê³ " class="admin-logo" onclick="toggleAdmin()" title="ê´€ë¦¬ì í™•ì¸">
    
    <div id="balanceDisplay" style="display:none; text-align:center; margin-top:15px; font-size:16px; font-weight:bold; color:#1a73e8;"></div>
</div>

<div class="container" id="successView">
    <div style="font-size: 50px;">âœ…</div>
    <h3>ì£¼ë¬¸ ì™„ë£Œ!</h3>
    <button class="submit-btn" style="background:#333;" onclick="showReceipt()">ì£¼ë¬¸ë‚´ì—­ í™•ì¸</button>
</div>

<div class="container" id="receiptView">
    <div class="receipt-card">
        <div style="text-align:center; font-weight:bold; border-bottom:1px dashed #eee; padding-bottom:10px; margin-bottom:10px;">ì£¼ë¬¸ ì˜ìˆ˜ì¦</div>
        <div id="r-details" style="font-size:14px; line-height:2;"></div>
    </div>
    <button class="submit-btn" style="background:#333;" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ ê°€ê¸°(ì™„ë£Œ)</button>
</div>

<script>
    // âœ… ì‚¬ìš©ìë‹˜ì˜ GAS URL
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxVCtl5FDY08qP_uPFh5tvQyuCv5TyAX57dAE71RrmeCHska4E7b3_Ur57Dhg7EqI5v/exec";

    function initDate() {
        const today = new Date();
        document.getElementById('date').value = today.toISOString().split('T')[0];
    }
    initDate();

    function cleanNumberInput(obj) {
        let val = obj.value.replace(/[^0-9]/g, ""); 
        if(val) obj.value = Number(val).toLocaleString(); 
        else obj.value = "";
    }

    function confirmAndSubmit() {
        const name = document.getElementById('name').value;
        const count = document.getElementById('peopleCount').value;
        const rawAmount = Number(document.getElementById('receiptAmount').value.replace(/[^0-9]/g, ""));
        
        // ìœ ë™ì  ì°¨ê° ë¡œì§ (ì¸ì›ìˆ˜ * 1ë§Œì›ê³¼ ì…ë ¥ ê¸ˆì•¡ ì¤‘ ì‘ì€ ê°’ì„ ì°¨ê°)
        const limitAmount = count * 10000;
        const finalDeduction = Math.min(rawAmount, limitAmount);
        const extraAmount = rawAmount - finalDeduction;

        if(!name) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
        if(!rawAmount) { alert("ê²°ì œ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

        let msg = `[ì£¼ë¬¸ í™•ì¸]\nì´ë¦„: ${name}\nì¸ì›: ${count}ëª…\nì‹¤ì œ ì°¨ê°ì•¡: ${finalDeduction.toLocaleString()}ì›`;
        
        // ì¶”ê°€ ê¸ˆì•¡ì´ ë°œìƒí–ˆì„ ë•Œë§Œ í‘œì‹œ
        if (extraAmount > 0) {
            msg += `\nì¶”ê°€ ê²°ì œì•¡: ${extraAmount.toLocaleString()}ì›`;
        }

        msg += `\n\nì´ ë‚´ìš©ìœ¼ë¡œ ì¥ë¶€ì— ê¸°ë¡í• ê¹Œìš”?`;
        
        if(confirm(msg)) {
            submitData(name, count, rawAmount, finalDeduction, extraAmount);
        }
    }

    function submitData(name, count, rawAmount, finalDeduction, extraAmount) {
        const btn = document.getElementById('submitBtn');
        btn.disabled = true; btn.innerText = "ì €ì¥ ì¤‘...";

        const payload = {
            date: document.getElementById('date').value,
            name: name,
            item: `ì¸ì›:${count}ëª… (ì´:${rawAmount.toLocaleString()}ì› / ì¶”ê°€:${(extraAmount > 0 ? extraAmount : 0).toLocaleString()}ì›)`,
            amount: finalDeduction, 
            note: ""
        };

        fetch(GAS_URL, { method: "POST", body: JSON.stringify(payload) })
        .then(res => res.json())
        .then(res => {
            if(res.result === "success") {
                lastSavedData = { ...payload, extra: extraAmount };
                document.getElementById('inputView').style.display = 'none';
                document.getElementById('successView').style.display = 'block';
            } else {
                alert("ì €ì¥ ì—ëŸ¬: " + res.error);
                btn.disabled = false;
            }
        }).catch(e => { 
            alert("ì €ì¥ ì‹¤íŒ¨ (ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”)"); 
            btn.disabled = false; 
            btn.innerText = "ì£¼ë¬¸ ì €ì¥í•˜ê¸°";
        });
    }

    function showReceipt() {
        const r = lastSavedData;
        let details = `ë‚ ì§œ: ${r.date}<br>ì´ë¦„: ${r.name}<br>ë‚´ìš©: ${r.item}<br><b>ê²°ì¬ê¸ˆì•¡: ${Number(r.amount).toLocaleString()}ì›</b><br>`;
        
        if (r.extra > 0) {
            details += `<span style="color:#e31837;">ê°œë³„ ì¶”ê°€ê¸ˆ: ${r.extra.toLocaleString()}ì›</span><br>`;
        }
        
        // ì¼ë°˜ ì‚¬ìš©ìì—ê²ŒëŠ” ì”ì•¡ í‘œì‹œ ì•ˆ í•¨
        document.getElementById('r-details').innerHTML = details;
        document.getElementById('successView').style.display = 'none';
        document.getElementById('receiptView').style.display = 'block';
    }

    function toggleAdmin() {
        const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        if(pw === "11223344") {
            fetch(GAS_URL + "?action=getBalance").then(res => res.text()).then(res => {
                const disp = document.getElementById('balanceDisplay');
                disp.style.display = 'block'; 
                disp.innerText = "í˜„ì¬ ë‚¨ì€ ì”ì•¡: " + res;
            });
        }
    }
</script>
</body>
</html>
